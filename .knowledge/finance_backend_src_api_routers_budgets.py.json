{"is_source_file": true, "format": "Python", "description": "The file defines API routes for managing and summarizing budget data within a financial backend API. It includes models, endpoints for listing, creating/updating budgets, and generating budget summaries, heavily integrated with FastAPI, SQLAlchemy, and Pydantic.", "external_files": ["src.core.security", "src.db.models", "src.db.schemas", "src.db.session"], "external_methods": ["get_current_user", "get_db", "Session.execute", "Session.add", "Session.commit", "Session.refresh"], "published": ["list_budgets", "upsert_budget", "budget_summary"], "classes": [{"name": "BudgetUpsert", "description": "Schema for creating or updating a budget entry, extending BudgetCreateSchema without additional fields."}, {"name": "BudgetQueryParams", "description": "Model parsing query parameters for filtering budgets, validates period and start date format."}, {"name": "BudgetSummaryItem", "description": "Model representing individual category budget vs spent summary for a month."}, {"name": "BudgetSummaryResponse", "description": "Model encapsulating overall monthly budget summary including items and total figures."}], "methods": [{"name": "tuple[date,date] _month_date_range(month_str: str)", "description": "Calculates start and end dates for a given month string in YYYY-MM format.", "scope": "", "scopeKind": ""}, {"name": "str _validate_period(cls, v: str)", "scope": "BudgetQueryParams", "scopeKind": "class", "description": "unavailable"}, {"name": "str _validate_start(cls, v: str)", "scope": "BudgetQueryParams", "scopeKind": "class", "description": "unavailable"}, {"name": "BudgetSummaryResponse budget_summary( db: Annotated[Session, Depends(get_db)], current_user: Annotated[User, Depends(get_current_user)], month: str = Query(..., description=\"Target month in YYYY-MM\"), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "list[BudgetSchema] list_budgets( db: Annotated[Session, Depends(get_db)], current_user: Annotated[User, Depends(get_current_user)], period: str = Query(\"month\", description=\"Period granularity, e.g., 'month'\"), start: str = Query(..., description=\"Start period, for month use YYYY-MM\"), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "BudgetSchema upsert_budget( payload: BudgetUpsert, db: Annotated[Session, Depends(get_db)], current_user: Annotated[User, Depends(get_current_user)], )", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["select(Budget)", "select(Transaction.category, func.sum(Transaction.amount))", "db.execute(...)", "db.scalars().all()", "db.execute().scalars().all()", "db.execute().all()"], "search-terms": ["budgets", "Budget", "budget_summary", "API router", "FastAPI", "SQLAlchemy query", "budget upsert", "budget list", "budget summary"], "state": 2, "file_id": 12, "knowledge_revision": 112, "git_revision": "2d1bfb1735f32536bce9a804478ddb802a807fd7", "revision_history": [{"35": ""}, {"37": "5aee07987af510ae933ffc98867b81b513a1a29f"}, {"43": "5aee07987af510ae933ffc98867b81b513a1a29f"}, {"111": "2d1bfb1735f32536bce9a804478ddb802a807fd7"}, {"112": "2d1bfb1735f32536bce9a804478ddb802a807fd7"}], "ctags": [{"_type": "tag", "name": "BudgetCreateSchema", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^from src.db.schemas import BudgetCreate as BudgetCreateSchema$/", "language": "Python", "kind": "unknown", "nameref": "unknown:BudgetCreate"}, {"_type": "tag", "name": "BudgetQueryParams", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^class BudgetQueryParams(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "BudgetSchema", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^from src.db.schemas import Budget as BudgetSchema$/", "language": "Python", "kind": "unknown", "nameref": "unknown:Budget"}, {"_type": "tag", "name": "BudgetSummaryItem", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^class BudgetSummaryItem(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "BudgetSummaryResponse", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^class BudgetSummaryResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "BudgetUpsert", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^class BudgetUpsert(BudgetCreateSchema):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_month_date_range", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^def _month_date_range(month_str: str) -> tuple[date, date]:$/", "language": "Python", "typeref": "typename:tuple[date,date]", "kind": "function", "signature": "(month_str: str)"}, {"_type": "tag", "name": "_validate_period", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^    def _validate_period(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "BudgetQueryParams", "scopeKind": "class"}, {"_type": "tag", "name": "_validate_start", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^    def _validate_start(cls, v: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "member", "signature": "(cls, v: str)", "scope": "BudgetQueryParams", "scopeKind": "class"}, {"_type": "tag", "name": "budget", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^    budget: float = Field(..., description=\"Budgeted amount for the month\\/category\")$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "BudgetSummaryItem", "scopeKind": "class"}, {"_type": "tag", "name": "budget_summary", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^def budget_summary($/", "language": "Python", "typeref": "typename:BudgetSummaryResponse", "kind": "function", "signature": "( db: Annotated[Session, Depends(get_db)], current_user: Annotated[User, Depends(get_current_user)], month: str = Query(..., description=\"Target month in YYYY-MM\"), )"}, {"_type": "tag", "name": "category", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^    category: str = Field(..., description=\"Category name\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "BudgetSummaryItem", "scopeKind": "class"}, {"_type": "tag", "name": "items", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^    items: List[BudgetSummaryItem] = Field(default_factory=list, description=\"Per-category summa/", "language": "Python", "typeref": "typename:List[BudgetSummaryItem]", "kind": "variable", "scope": "BudgetSummaryResponse", "scopeKind": "class"}, {"_type": "tag", "name": "list_budgets", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^def list_budgets($/", "language": "Python", "typeref": "typename:list[BudgetSchema]", "kind": "function", "signature": "( db: Annotated[Session, Depends(get_db)], current_user: Annotated[User, Depends(get_current_user)], period: str = Query(\"month\", description=\"Period granularity, e.g., 'month'\"), start: str = Query(..., description=\"Start period, for month use YYYY-MM\"), )"}, {"_type": "tag", "name": "month", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^    month: str = Field(..., description=\"Month in YYYY-MM\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "BudgetSummaryItem", "scopeKind": "class"}, {"_type": "tag", "name": "month", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^    month: str = Field(..., description=\"Month summarized (YYYY-MM)\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "BudgetSummaryResponse", "scopeKind": "class"}, {"_type": "tag", "name": "period", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^    period: str = Field(\"month\", description=\"Budget period granularity, currently only 'month' /", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "BudgetQueryParams", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^router = APIRouter(prefix=\"\\/budgets\", tags=[\"budgets\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "spent", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^    spent: float = Field(..., description=\"Total spent amount (expenses only, positive value)\")$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "BudgetSummaryItem", "scopeKind": "class"}, {"_type": "tag", "name": "start", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^    start: str = Field(..., description=\"Start period, format depends on period. For 'month', us/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "BudgetQueryParams", "scopeKind": "class"}, {"_type": "tag", "name": "totals", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^    totals: Dict[str, float] = Field(default_factory=dict, description=\"Overall totals for the m/", "language": "Python", "typeref": "typename:Dict[str, float]", "kind": "variable", "scope": "BudgetSummaryResponse", "scopeKind": "class"}, {"_type": "tag", "name": "upsert_budget", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^def upsert_budget($/", "language": "Python", "typeref": "typename:BudgetSchema", "kind": "function", "signature": "( payload: BudgetUpsert, db: Annotated[Session, Depends(get_db)], current_user: Annotated[User, Depends(get_current_user)], )"}, {"_type": "tag", "name": "utilization_pct", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/api/routers/budgets.py", "pattern": "/^    utilization_pct: float = Field(..., description=\"Spent \\/ Budget * 100 (0 when budget is 0)\"/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "BudgetSummaryItem", "scopeKind": "class"}], "hash": "d93aea99f35f94203e4d1c9afacc90ae", "format-version": 4, "code-base-name": "finance_backend", "filename": "finance_backend/src/api/routers/budgets.py", "fields": [{"name": "float budget", "scope": "BudgetSummaryItem", "scopeKind": "class", "description": "unavailable"}, {"name": "str category", "scope": "BudgetSummaryItem", "scopeKind": "class", "description": "unavailable"}, {"name": "List[BudgetSummaryItem] items", "scope": "BudgetSummaryResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str month", "scope": "BudgetSummaryItem", "scopeKind": "class", "description": "unavailable"}, {"name": "str period", "scope": "BudgetQueryParams", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(prefix=\"\\/budgets\", tags=[\"budgets\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "float spent", "scope": "BudgetSummaryItem", "scopeKind": "class", "description": "unavailable"}, {"name": "str start", "scope": "BudgetQueryParams", "scopeKind": "class", "description": "unavailable"}, {"name": "Dict[str, float] totals", "scope": "BudgetSummaryResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "float utilization_pct", "scope": "BudgetSummaryItem", "scopeKind": "class", "description": "unavailable"}]}