{"is_source_file": true, "format": "Python", "description": "This file is a Python script that manages database migrations by executing SQL files found in a specific directory. It discovers, sorts, and applies SQL scripts to a database, supporting PostgreSQL and SQLite, and optionally uses the 'sqlparse' library for accurate statement splitting.", "external_files": ["src/core/config"], "external_methods": ["src.core.config.get_settings"], "published": ["main"], "classes": [], "methods": [{"name": "str _get_db_url()", "description": "Resolves the database URL from environment variables or fallback settings.", "scope": "", "scopeKind": ""}, {"name": "Engine _create_engine(db_url: str)", "description": "Creates a SQLAlchemy engine object configured for the database URL.", "scope": "", "scopeKind": ""}, {"name": "str _read_sql_file(path: Path)", "description": "Reads the contents of a SQL file.", "scope": "", "scopeKind": ""}, {"name": "List[str] _split_sql_statements(sql: str)", "description": "Splits SQL script into individual statements, preferring sqlparse but falling back to naive split.", "scope": "", "scopeKind": ""}, {"name": "None _apply_sql_file(engine: Engine, path: Path)", "description": "Executes all SQL statements from a given file within a transaction.", "scope": "", "scopeKind": ""}, {"name": "List[Path] _discover_migrations(directory: Path)", "description": "Finds and sorts migration SQL files in the directory.", "scope": "", "scopeKind": ""}, {"name": "int main(argv: List[str] | None = None)", "description": "Main entry point that orchestrates the discovery and application of all migration files.", "scope": "", "scopeKind": ""}, {"name": "dict get_settings()", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["sqlalchemy.create_engine", "sqlalchemy.text", "os.getenv", "pathlib.Path.iterdir", "pathlib.Path.exists", "sys.argv", "sys.exit", "print", "Exception"], "search-terms": ["migration runner", "SQL file discovery", "PostgreSQL migrations", "apply SQL scripts", "sqlparse fallback", "database URL resolution", "database migration script", "Python migration script"], "state": 2, "file_id": 21, "knowledge_revision": 81, "git_revision": "", "ctags": [{"_type": "tag", "name": "MIGRATIONS_DIR", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^MIGRATIONS_DIR = Path(__file__).resolve().parent \\/ \"migrations\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_apply_sql_file", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def _apply_sql_file(engine: Engine, path: Path) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(engine: Engine, path: Path)"}, {"_type": "tag", "name": "_create_engine", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def _create_engine(db_url: str) -> Engine:$/", "language": "Python", "typeref": "typename:Engine", "kind": "function", "signature": "(db_url: str)"}, {"_type": "tag", "name": "_discover_migrations", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def _discover_migrations(directory: Path) -> List[Path]:$/", "language": "Python", "typeref": "typename:List[Path]", "kind": "function", "signature": "(directory: Path)"}, {"_type": "tag", "name": "_get_db_url", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def _get_db_url() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_read_sql_file", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def _read_sql_file(path: Path) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(path: Path)"}, {"_type": "tag", "name": "_split_sql_statements", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def _split_sql_statements(sql: str) -> List[str]:$/", "language": "Python", "typeref": "typename:List[str]", "kind": "function", "signature": "(sql: str)"}, {"_type": "tag", "name": "get_settings", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^    def get_settings() -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "main", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def main(argv: List[str] | None = None) -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "(argv: List[str] | None = None)"}, {"_type": "tag", "name": "sqlparse", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^    sqlparse = None  # type: ignore$/", "language": "Python", "kind": "variable"}], "hash": "e9b61c6f7047958b98e71f520f395bd6", "format-version": 4, "code-base-name": "finance_backend", "filename": "finance_backend/src/db/migrate.py", "fields": [{"name": "MIGRATIONS_DIR = Path(__file__).resolve().parent \\/ \"migrations\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "sqlparse = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"81": ""}]}