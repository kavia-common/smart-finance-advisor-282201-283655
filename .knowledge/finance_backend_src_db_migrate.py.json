{"is_source_file": true, "format": "Python", "description": "This script is a Python utility for running SQL migration files within a project. It discovers SQL files in a specific directory, applies their statements in order, and handles execution within transactions. It uses SQLAlchemy for database interactions and optionally sqlparse for parsing SQL scripts.", "external_files": ["src/core/config"], "external_methods": ["get_settings"], "published": [], "classes": [], "methods": [{"name": "str _get_db_url()", "description": "Resolves the database URL from environment variables or settings.", "scope": "", "scopeKind": ""}, {"name": "Engine _create_engine(db_url: str)", "description": "Creates a SQLAlchemy engine with appropriate connection arguments based on the database URL.", "scope": "", "scopeKind": ""}, {"name": "str _read_sql_file(path: Path)", "description": "Reads the contents of a SQL file.", "scope": "", "scopeKind": ""}, {"name": "List[str] _split_sql_statements(sql: str)", "description": "Splits a SQL script into separate executable statements, using sqlparse if available.", "scope": "", "scopeKind": ""}, {"name": "None _apply_sql_file(engine: Engine, path: Path)", "description": "Executes all SQL statements from a given file within a transaction.", "scope": "", "scopeKind": ""}, {"name": "List[Path] _discover_migrations(directory: Path)", "description": "Finds and sorts .sql migration files within the designated migrations directory.", "scope": "", "scopeKind": ""}, {"name": "int main(argv: List[str] | None = None)", "description": "Main function to coordinate the database migration process by applying all migration files.", "scope": "", "scopeKind": ""}, {"name": "dict get_settings()", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["create_engine", "text", "_read_sql_file", "_split_sql_statements", "_apply_sql_file", "_discover_migrations", "print", "sys.argv", "sys.exit"], "search-terms": ["migrate.py", "SQL migration runner", "PostgreSQL migration", "sql files in migrations directory", "sqlparse", "apply SQL in order", "discovery of migration files", "Python database migration"], "state": 2, "file_id": 21, "knowledge_revision": 84, "git_revision": "9d25d782dab3da49a9b80a8563b3c33826a533b2", "revision_history": [{"81": ""}, {"84": "9d25d782dab3da49a9b80a8563b3c33826a533b2"}], "ctags": [{"_type": "tag", "name": "MIGRATIONS_DIR", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^MIGRATIONS_DIR = Path(__file__).resolve().parent \\/ \"migrations\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_apply_sql_file", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def _apply_sql_file(engine: Engine, path: Path) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(engine: Engine, path: Path)"}, {"_type": "tag", "name": "_create_engine", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def _create_engine(db_url: str) -> Engine:$/", "language": "Python", "typeref": "typename:Engine", "kind": "function", "signature": "(db_url: str)"}, {"_type": "tag", "name": "_discover_migrations", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def _discover_migrations(directory: Path) -> List[Path]:$/", "language": "Python", "typeref": "typename:List[Path]", "kind": "function", "signature": "(directory: Path)"}, {"_type": "tag", "name": "_get_db_url", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def _get_db_url() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_read_sql_file", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def _read_sql_file(path: Path) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(path: Path)"}, {"_type": "tag", "name": "_split_sql_statements", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def _split_sql_statements(sql: str) -> List[str]:$/", "language": "Python", "typeref": "typename:List[str]", "kind": "function", "signature": "(sql: str)"}, {"_type": "tag", "name": "get_settings", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^    def get_settings() -> dict:$/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "main", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^def main(argv: List[str] | None = None) -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "(argv: List[str] | None = None)"}, {"_type": "tag", "name": "sqlparse", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/db/migrate.py", "pattern": "/^    sqlparse = None  # type: ignore$/", "language": "Python", "kind": "variable"}], "hash": "df2bcf73ea47d4ef23a343640833cdc1", "format-version": 4, "code-base-name": "finance_backend", "filename": "finance_backend/src/db/migrate.py", "fields": [{"name": "MIGRATIONS_DIR = Path(__file__).resolve().parent \\/ \"migrations\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "sqlparse = None  # type: ignore", "scope": "", "scopeKind": "", "description": "unavailable"}]}