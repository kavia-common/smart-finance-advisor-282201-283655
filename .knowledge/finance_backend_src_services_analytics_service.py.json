{"is_source_file": true, "format": "Python", "description": "This file contains analytic functions for a finance backend service, including computation of transaction summaries, data bucketing by day/week/month, and behavioral insights such as top spending categories and most expensive days. It leverages SQLAlchemy ORM models and data classes for data handling.", "external_files": ["src/db/models.py"], "external_methods": ["sqlalchemy.select", "sqlalchemy.and_", "sqlalchemy.func", "sqlalchemy.orm.Session", "Transaction", "date.today()"], "published": ["compute_summary", "compute_behaviors"], "classes": [{"name": "DateRange", "description": "Data class representing a date range with start and end dates."}], "methods": [{"name": "date _coerce_date(d: date | datetime)", "description": "Converts a date or datetime object to a date.", "scope": "", "scopeKind": ""}, {"name": "date _month_start(d: date)", "description": "Returns the first day of the month for a given date.", "scope": "", "scopeKind": ""}, {"name": "date _next_month_start(d: date)", "description": "Returns the first day of the following month for a given date.", "scope": "", "scopeKind": ""}, {"name": "Tuple[Literal[\"day\",\"week\",\"month\"],DateRange] compute_date_range( period: Literal[\"day\", \"week\", \"month\"] | None, start: Optional[date], end: Optional[date], )", "description": "Calculates and normalizes a date range based on optional start, end, and period parameters.", "scope": "", "scopeKind": ""}, {"name": "list[Transaction] _fetch_transactions(db: Session, user_id: int, rng: DateRange)", "description": "Retrieves transactions from the database within a given date range for a specific user.", "scope": "", "scopeKind": ""}, {"name": "bool _is_income(tx: Transaction)", "description": "Determines if a transaction is income based on its type or amount.", "scope": "", "scopeKind": ""}, {"name": "dict compute_summary( db: Session, user_id: int, period: Optional[Literal[\"day\", \"week\", \"month\"]] = None, start: Optional[date] = None, end: Optional[date] = None, )", "description": "Generates a financial summary over a specified date range for a user, including totals, trend, and breakdowns.", "scope": "", "scopeKind": ""}, {"name": "dict compute_behaviors( db: Session, user_id: int, start: Optional[date] = None, end: Optional[date] = None, )", "description": "Provides behavioral insights such as top categories, most expensive day, and income days count.", "scope": "", "scopeKind": ""}, {"name": "str bucket_key(d: date)", "scope": "compute_summary", "scopeKind": "function", "description": "unavailable"}], "calls": ["select", "and_", "func", "Session.execute", "_fetch_transactions", "_is_income", "_coerce_date", "_month_start", "_next_month_start"], "search-terms": ["analytics_service", "compute_summary", "compute_behaviors", "transaction bucketing", "spending analysis", "financial trends", "category breakdown", "behavioral insights"], "state": 2, "file_id": 14, "knowledge_revision": 59, "git_revision": "", "ctags": [{"_type": "tag", "name": "DateRange", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^class DateRange:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_coerce_date", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def _coerce_date(d: date | datetime) -> date:$/", "language": "Python", "typeref": "typename:date", "kind": "function", "signature": "(d: date | datetime)"}, {"_type": "tag", "name": "_fetch_transactions", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def _fetch_transactions(db: Session, user_id: int, rng: DateRange) -> list[Transaction]:$/", "language": "Python", "typeref": "typename:list[Transaction]", "kind": "function", "signature": "(db: Session, user_id: int, rng: DateRange)"}, {"_type": "tag", "name": "_is_income", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def _is_income(tx: Transaction) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(tx: Transaction)"}, {"_type": "tag", "name": "_month_start", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def _month_start(d: date) -> date:$/", "language": "Python", "typeref": "typename:date", "kind": "function", "signature": "(d: date)"}, {"_type": "tag", "name": "_next_month_start", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def _next_month_start(d: date) -> date:$/", "language": "Python", "typeref": "typename:date", "kind": "function", "signature": "(d: date)"}, {"_type": "tag", "name": "bucket_key", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^    def bucket_key(d: date) -> str:$/", "file": true, "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(d: date)", "scope": "compute_summary", "scopeKind": "function"}, {"_type": "tag", "name": "compute_behaviors", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def compute_behaviors($/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "( db: Session, user_id: int, start: Optional[date] = None, end: Optional[date] = None, )"}, {"_type": "tag", "name": "compute_date_range", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def compute_date_range($/", "language": "Python", "typeref": "typename:Tuple[Literal[\"day\",\"week\",\"month\"],DateRange]", "kind": "function", "signature": "( period: Literal[\"day\", \"week\", \"month\"] | None, start: Optional[date], end: Optional[date], )"}, {"_type": "tag", "name": "compute_summary", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def compute_summary($/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "( db: Session, user_id: int, period: Optional[Literal[\"day\", \"week\", \"month\"]] = None, start: Optional[date] = None, end: Optional[date] = None, )"}], "hash": "86dda944f5df419d829bbf2cd7fb3d43", "format-version": 4, "code-base-name": "finance_backend", "filename": "finance_backend/src/services/analytics_service.py", "revision_history": [{"59": ""}]}