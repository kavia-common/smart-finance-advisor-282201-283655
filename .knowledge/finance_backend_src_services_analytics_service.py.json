{"is_source_file": true, "format": "Python", "description": "This file defines analytics services for a financial application, including functions to compute date ranges, fetch transactions, generate financial summaries, and analyze spending behaviors, using SQLAlchemy ORM models and dataclasses.", "external_files": ["src/db/models.py"], "external_methods": ["sqlalchemy.select", "sqlalchemy.and_"], "published": ["compute_summary", "compute_behaviors"], "classes": [{"name": "DateRange", "description": "A simple dataclass representing a date interval with start and end dates."}], "methods": [{"name": "date _coerce_date(d: date | datetime)", "description": "Converts a date or datetime object into a date object.", "scope": "", "scopeKind": ""}, {"name": "date _month_start(d: date)", "description": "Returns the first day of the month for a given date.", "scope": "", "scopeKind": ""}, {"name": "date _next_month_start(d: date)", "description": "Returns the first day of the next month following the given date.", "scope": "", "scopeKind": ""}, {"name": "Tuple[Literal[\"day\",\"week\",\"month\"],DateRange] compute_date_range( period: Literal[\"day\", \"week\", \"month\"] | None, start: Optional[date], end: Optional[date], )", "description": "Calculates and normalizes the date range and period (day, week, month) based on inputs.", "scope": "", "scopeKind": ""}, {"name": "list[Transaction] _fetch_transactions(db: Session, user_id: int, rng: DateRange)", "description": "Retrieves transactions for a user over a specified date range from the database.", "scope": "", "scopeKind": ""}, {"name": "bool _is_income(tx: Transaction)", "description": "Determines if a transaction is income based on its type or amount.", "scope": "", "scopeKind": ""}, {"name": "dict compute_summary( db: Session, user_id: int, period: Optional[Literal[\"day\", \"week\", \"month\"]] = None, start: Optional[date] = None, end: Optional[date] = None, )", "description": "Generates a financial summary over a specified date range, including totals, trend data, and breakdowns.", "scope": "", "scopeKind": ""}, {"name": "dict compute_behaviors( db: Session, user_id: int, start: Optional[date] = None, end: Optional[date] = None, )", "description": "Analyzes spending behaviors like top categories, most expensive days, and income days.", "scope": "", "scopeKind": ""}, {"name": "str bucket_key(d: date)", "scope": "compute_summary", "scopeKind": "function", "description": "unavailable"}], "calls": ["select", "select().where()", "select().order_by()", "db.execute()", "list()", "abs()", "date.today()", "date.isoformat()", "date.weekday()", "date.isocalendar()", "timedelta()", "_coerce_date()", "_month_start()", "_next_month_start()", "compute_date_range()", "_fetch_transactions()", "_is_income()"], "search-terms": ["analytics_service", "compute_summary", "compute_behaviors", "DateRange", "transaction fetching", "spending analysis", "SQLAlchemy ORM", "date range calculation"], "state": 2, "file_id": 14, "knowledge_revision": 63, "git_revision": "dfc0128133c1426ed8425c18521b34b454f4a56d", "revision_history": [{"59": ""}, {"63": "dfc0128133c1426ed8425c18521b34b454f4a56d"}], "ctags": [{"_type": "tag", "name": "DateRange", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^class DateRange:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_coerce_date", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def _coerce_date(d: date | datetime) -> date:$/", "language": "Python", "typeref": "typename:date", "kind": "function", "signature": "(d: date | datetime)"}, {"_type": "tag", "name": "_fetch_transactions", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def _fetch_transactions(db: Session, user_id: int, rng: DateRange) -> list[Transaction]:$/", "language": "Python", "typeref": "typename:list[Transaction]", "kind": "function", "signature": "(db: Session, user_id: int, rng: DateRange)"}, {"_type": "tag", "name": "_is_income", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def _is_income(tx: Transaction) -> bool:$/", "language": "Python", "typeref": "typename:bool", "kind": "function", "signature": "(tx: Transaction)"}, {"_type": "tag", "name": "_month_start", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def _month_start(d: date) -> date:$/", "language": "Python", "typeref": "typename:date", "kind": "function", "signature": "(d: date)"}, {"_type": "tag", "name": "_next_month_start", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def _next_month_start(d: date) -> date:$/", "language": "Python", "typeref": "typename:date", "kind": "function", "signature": "(d: date)"}, {"_type": "tag", "name": "bucket_key", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^    def bucket_key(d: date) -> str:$/", "file": true, "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(d: date)", "scope": "compute_summary", "scopeKind": "function"}, {"_type": "tag", "name": "compute_behaviors", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def compute_behaviors($/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "( db: Session, user_id: int, start: Optional[date] = None, end: Optional[date] = None, )"}, {"_type": "tag", "name": "compute_date_range", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def compute_date_range($/", "language": "Python", "typeref": "typename:Tuple[Literal[\"day\",\"week\",\"month\"],DateRange]", "kind": "function", "signature": "( period: Literal[\"day\", \"week\", \"month\"] | None, start: Optional[date], end: Optional[date], )"}, {"_type": "tag", "name": "compute_summary", "path": "/home/kavia/workspace/code-generation/smart-finance-advisor-282201-283655/finance_backend/src/services/analytics_service.py", "pattern": "/^def compute_summary($/", "language": "Python", "typeref": "typename:dict", "kind": "function", "signature": "( db: Session, user_id: int, period: Optional[Literal[\"day\", \"week\", \"month\"]] = None, start: Optional[date] = None, end: Optional[date] = None, )"}], "hash": "8791f93ad2f421656b3caa359b451556", "format-version": 4, "code-base-name": "finance_backend", "filename": "finance_backend/src/services/analytics_service.py"}